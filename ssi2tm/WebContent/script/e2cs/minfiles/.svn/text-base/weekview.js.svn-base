Ext.ECalendar.weekview=function(config){this.referid='weekview';this.header=true;this.headerButtons=true;this.headerFormat='W';this.headerShowDates=true;this.dayformatLabel='D j';this.scrolltoHour=false;this.hourFormat='G:i';this.startTime='00:00:00 am';this.endTime='11:59:59 pm';this.style='google';this.alldayTaksMore='window';this.alldayTaskTPL=new Ext.XTemplate('<tpl for="."><div class="ecal-show-basetasktpl-div">Event:{subject}<br>Location:{location}','Starts:{startdate}<br>Ends:{enddate}<br>Description:<br>{description}<div><hr></tpl>');this.alldayTasksMaxView=3;this.alldayTasks=[];this.weekTasks=[];this.store=null;this.headerDayClick='none';this.currentweek=1;this.task_format='d-m-Y H:i:s a';this.task_bgcolor_base='#E0FFA2';this.task_showqtip=true;this.task_width=50;this.tasksOffset=20;this.taskelements=0;this.ShowMenuItems=[1,1,1,1,1,1];this.task_ShowMenuItems=[1,1,1,1,1];this.moreMenuItems=[];this.task_eventLaunch='click';this.taskAdd_timer_dblclick=false;this.scrolltoHour=false;this.allday24HinsideBody=false;this.task_clsOver='';this.forceTaskFit=false;this.startDay=1;this.customHTMLinpos='before';this.headerUseTpl=false;this.headerTpl=new Ext.XTemplate('<tpl for=".">{title}-from {initday:this.formatx} to {enday:this.formatx}</tpl>',{formatx:function(value){return value.format('m-d-y');}});this.headerData={title:'Custom header for Week',initday:new Date(),enday:new Date()};Ext.apply(this,config);this.addEvents('dblClickTaskAllDay','beforeWeekChange','afterWeekChange','launchEventList');Ext.ECalendar.weekview.superclass.constructor.call(this);};Ext.extend(Ext.ECalendar.weekview,Ext.util.Observable,{init:function(calendar,dateval){this.calx=calendar;this.datetohandle=dateval;},refreshView:function(){this.render();},render:function(){this.datetohandle=this.calx.currentdate;var daterange=this.getDatesforWeek(this.datetohandle);var updateview=Ext.get(this.calx.body);var testrender=updateview.dom.childNodes.length;if(testrender){for(var i=testrender;i<testrender;i++){updateview.dom.removeChild(updateview.dom.childNodes[0]);}}updateview.update('');var updateview=Ext.get(this.calx.body);var daycntbase='<div id="'+this.calx.id+'-main-calendar-header"></div>';daycntbase+='<div id="'+this.calx.id+'-main-calendar-week-body"></div>';updateview.update(daycntbase);if(this.header){var dt=this.datetohandle;var tmpheader=Ext.get(this.calx.id+'-main-calendar-header');var prueba2=tmpheader;var myheaderwrap=prueba2.wrap({tag:'div',cls:'x-calendar-weekv-header',html:''});if(this.headerButtons){var prevdclick=myheaderwrap.createChild({id:this.calx.id+'-btn-pw',tag:'div',cls:'x-calendar-week-previous',html:''});var nextdclick=myheaderwrap.createChild({id:this.calx.id+'-btn-nw',tag:'div',cls:'x-calendar-week-next',html:''});prevdclick.dom['qtip']=e2cs.cal_locale.headerTooltipsWeek.prev;prevdclick.addListener('click',function(){this.onclickprev_week();},this);prevdclick.addClassOnOver('x-calendar-week-previous-over');nextdclick.dom['qtip']=e2cs.cal_locale.headerTooltipsWeek.next;nextdclick.addListener('click',function(){this.onclicknext_week();},this);nextdclick.addClassOnOver('x-calendar-week-next-over');}if(this.headerUseTpl){var htmlinheader=this.headerTpl.apply(this.headerData);var headerdx=myheaderwrap.createChild({tag:'div',id:this.calx.id+'-sub-'+'header',html:''+htmlinheader+''});}else{complementtext='';if(this.headerShowDates){complementtext=' <span class="x-calendar-weekv-header-small">'+e2cs.cal_locale.weekheaderlabel_from+daterange[0].format('d/m/Y')+e2cs.cal_locale.weekheaderlabel_to+daterange[1].format('d/m/Y')+'</span>';}if(daterange[0].format(this.headerFormat)==daterange[1].format(this.headerFormat)){var hdrweeknumtxt=e2cs.cal_locale.weekheaderlabel+dt.format(this.headerFormat);}else{var hdrweeknumtxt=e2cs.cal_locale.weekheaderlabel+daterange[0].format(this.headerFormat)+" - "+daterange[1].format(this.headerFormat);}var headerdx=myheaderwrap.createChild({tag:'div',id:this.calx.id+'-sub-'+'header',html:''+hdrweeknumtxt+complementtext+''});}}var tmpdays=Ext.get(this.calx.id+'-main-calendar-week-body');var weeklayoutskel=tmpdays.createChild({tag:'div',id:this.calx.id+'-weekvbody',cls:'x-calendar-weekv-body',html:''});var daterange=this.getDatesforWeek(this.datetohandle);if(this.style=='plain'){daysintro=this.genDaysHeader(daterange[0]);weeklayoutskel.insertHtml('beforeEnd',daysintro,false);}else{daysintro=this.genAlldayContainer(daterange[0]);weeklayoutskel.insertHtml('beforeEnd',daysintro,false);var mydaybodytmp=Ext.get(this.calx.id+'-allday1');var myallcontainer=Ext.get(this.calx.id+'-alldaycontainer');var myallreferh=Ext.get('alldayrefer');myallcontainer.setXY(mydaybodytmp.getXY());myallcontainer.setHeight(mydaybodytmp.getHeight(true));ancho=0;for(var i=1;i<8;i++){ancho+=Ext.get(this.calx.id+'-allday'+i).getWidth(false);}if(Ext.isIE){ancho+=7;}else{ancho+=5;}myallcontainer.setWidth(ancho,false);var moretaskbuttonallday=Ext.get('alldaylistbutton');var taskstmp=this.getWeekTasks(this.datetohandle,0);if(myallcontainer.dom.childNodes.length==1&&myallcontainer.dom.childNodes[0].childNodes.length==0){moretaskbuttonallday.setDisplayed('none');}else{if(taskstmp.length>this.alldayTasksMaxView){moretaskbuttonallday.setDisplayed('block');}else{moretaskbuttonallday.setDisplayed('none');}}moretaskbuttonallday.addClassOnOver('alldaylistover');moretaskbuttonallday.addListener('click',function(){this.showMoreTasksList();},this);}var bodyweekhtml=this.genBody(daterange[0]);weeklayoutskel.insertHtml('beforeEnd',bodyweekhtml,false);for(var i=1;i<8;i++){var tmpeachdaybodygrid=Ext.get(this.calx.id+'-day'+i);tmpeachdaybodygrid.setHeight(Ext.get(this.calx.id+'-wd'+i).getHeight(true));var containerdaytmp=Ext.get(tmpeachdaybodygrid.dom.childNodes[0]);containerdaytmp.setHeight(Ext.get(this.calx.id+'-wd'+i).getHeight(false));if(Ext.isOpera){containerdaytmp.addListener('mousedown',this.operabuttons_body,this);}else{containerdaytmp.on('contextmenu',this.oncontextmenu_bodyday,this,{stopPropagation:true,stopEvent:true,normalized:true,preventDefault:true});}}var bodydisp=Ext.get(this.calx.id+'-weekbodydisplay');if(Ext.isIE){bodydisp.setStyle({position:'relative'});}this.calx.height=this.calx.getInnerHeight();if(!this.calx.height||this.calx.height=='undefined'){if(this.calx.getEl().dom.offsetParent!=null){var tmpheight=this.calx.getEl().dom.offsetParent.clientHeight;}else{var tmpheight=0;}}else{var tmpheight=this.calx.height;}if(tmpheight==0){tmpheight=300;}styleheaderheight=0;if(this.style=='plain'){styleheaderheight=Ext.get(this.calx.id+'-allday_w_task').getHeight(true)+8;}else{styleheaderheight=Ext.get(this.calx.id+'-allday_w_task').getHeight(true)+8;styleheaderheight+=Ext.get('alldaylistbutton').getHeight(true);}if(this.header){tmpheight+=-24;}if(this.calx.showCal_tbar){tmpheight+=-26;}if(this.calx.header){tmpheight+=-26;}var morehoffst=0;bodydisp.setStyle({height:''+(tmpheight-styleheaderheight)-morehoffst+'px'});bodydisp.setStyle({overflow:'auto'});if(Ext.isIE||Ext.isIE6){Ext.get(this.calx.id+'-tableweek-layout').setWidth(Ext.get(this.calx.id+'-tableweek-layout').getWidth()-16,false);Ext.get(this.calx.id+'-tableweek-layout').setStyle({position:'relative'});}var test=Ext.get(this.calx.id+'-weekbodydisplay').getHeight(true);var tableskel=Ext.get(this.calx.id+'-week-skeleton').getHeight(true);if(tableskel>test){if(this.style=='plain'){var tmpgridlayout=Ext.get(this.calx.id+'-alldaygridbodylayout');var tmptable=Ext.get(this.calx.id+'-tableallcontainer');for(var i=1;i<8;i++){Ext.get(this.calx.id+'-weekhdrday-'+i).setWidth(Ext.get(this.calx.id+'-wd'+i).getWidth(false),false);}ancho=tmpgridlayout.getWidth(false);if(Ext.isIE||Ext.isIE6){tmpgridlayout.setWidth((tmpgridlayout.getWidth()-17),false);}else{tmpgridlayout.setWidth((ancho-19),false);}}else{var tmpgridlayout=Ext.get(this.calx.id+'-alldaygridbodylayout');var tmptable=Ext.get(this.calx.id+'-tableallcontainer');ancho=0;for(var i=1;i<8;i++){ancho+=Ext.get(this.calx.id+'-allday'+i).getWidth(false);}if(Ext.isIE){ancho+=7;}else{ancho+=4;}myallcontainer.setWidth(ancho,false);ancho=tmpgridlayout.getWidth(false);if(Ext.isIE||Ext.isIE6){tmpgridlayout.setWidth((tmpgridlayout.getWidth()-19),true);myallcontainer.setWidth(myallcontainer.getWidth()-19,true);}else{tmpgridlayout.setWidth((ancho-18),false);myallcontainer.setWidth(myallcontainer.getWidth()-18,false);}}}if(this.style=='plain'){}else{var moretaskbuttonallday=Ext.get('alldaylistbutton');if(myallcontainer.dom.childNodes[0].childNodes.length==0&&myallcontainer.dom.childNodes[0].childNodes.length==0){}else{if(myallcontainer.dom.childNodes.length<this.alldayTasksMaxView){allcounterproc=myallcontainer.dom.childNodes.length;}else{allcounterproc=this.alldayTasksMaxView;}for(var i=0;i<allcounterproc;i++){alldaytasktmp=Ext.get(myallcontainer.dom.childNodes[i]);this.formatallDayTask(alldaytasktmp);if(this.task_eventLaunch!=''){alldaytasktmp.addListener(this.task_eventLaunch,this.onDblclick,this);}if(Ext.isOpera){alldaytasktmp.addListener('mousedown',this.operadaybuttons,this);}else{alldaytasktmp.addListener('contextmenu',this.oncontextmenu,this,{stopPropagation:false,normalized:true,preventDefault:true});}}}}this.snapweek=[];for(var i=1;i<8;i++){var toprocess=new Date(daterange[0].add(Date.DAY,(i-1)));var tmpdayweek=Ext.get(Ext.get(this.calx.id+'-day'+i).dom.childNodes[0]);var tmpdayweek_childs=tmpdayweek.dom.childNodes;tmpcalc=(this.task_width*tmpdayweek_childs);if(tmpcalc>tmpdayweek.getWidth(false)){}if(tmpdayweek_childs.length==1&&tmpdayweek_childs[0].childNodes.length==0){}else{var childcount=tmpdayweek_childs.length;for(var j=0;j<childcount;j++){var tmpel=Ext.get(tmpdayweek_childs[j]);if(Ext.isOpera){tmpel.addClass('taskondayopera');}else{tmpel.addClass('taskonday');}checkel=tmpel.id.indexOf(this.calx.id+'-ecal-daytask',0);if(checkel<0){}else{if(this.task_eventLaunch!=''){tmpel.addListener(this.task_eventLaunch,this.onDblclickSingleday,this);}if(this.task_clsOver!=''){tmpel.addClassOnOver(this.task_clsOver);}if(Ext.isOpera){tmpel.addListener('mousedown',this.operadaybuttons,this);}else{tmpel.addListener('contextmenu',this.oncontextmenu,this,{stopPropagation:false,normalized:true,preventDefault:true});}this.formatdayTask(toprocess,i,tmpel,j);}}}}if(this.headerDayClick=='viewday'){var myhdrweekdaysref=Ext.select('td.x-calendar-weekv-header-days',true);myhdrweekdaysref.each(function(el,thisobj,index){if(el.id.indexOf(this.calx.id+'-weekhdrday-')>=0){el.addClassOnOver('overwday');el.addListener('click',this.onWeekHeaderdayClick,this);}},this);}if(this.taskAdd_timer_dblclick){if(Ext.isIE){var mytimeTD_elements=Ext.select('td.hour-marker_ie',true);}else{var mytimeTD_elements=Ext.select('td.hour-marker',true);}var datetest=this.datetohandle;var tmpcalendarobjinstance=this.calx;mytimeTD_elements.each(function(el,thisobj,index){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-weekv-')+1>=1){el.addListener('dblclick',function(evx,elx,obx){if(elx.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-weekv-')<0){var mydt_element_test=Ext.get(elx).parent().id.replace(tmpcalendarobjinstance.id+'-tdbody-weekv-','');}else{var mydt_element_test=elx.id.replace(tmpcalendarobjinstance.id+'-tdbody-weekv-','');}var mytmpdatex=new Date(mydt_element_test);var mytmpdate=new Date(datetest.format('m/d/Y')+' '+mytmpdatex.format('G:i'));tmpcalendarobjinstance.fireEvent("taskAdd",mytmpdate);});}},this);}var cntcroll=Ext.get(this.calx.id+'-weekbodydisplay');cntcroll.dom.scrollTop=0;if(this.scrolltoHour){var sct_top=0;if(Ext.isIE){var mytimeTD_elements=Ext.select('td.hour-marker_ie',true);}else{var mytimeTD_elements=Ext.select('td.hour-marker',true);}mytimeTD_elements.each(function(el,thisobj,index){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-weekv-')+1>=1){var testfmt=this.datetohandle.format('G:i');if(testfmt=="00:00"||testfmt=="0:00"){testfmt=new Date().format('G:1');}if(el.id.indexOf(testfmt)+1>=1){sct_top=Ext.get(el).getY();return false;}}},this);if(sct_top>0){sct_top=sct_top-cntcroll.getY();cntcroll.dom.scrollTop=sct_top;}}bodydisp.setStyle({height:''+(tmpheight-styleheaderheight)-morehoffst+'px'});for(var i=0;i<7;i++){var test=1;if(i>0){test=2;}else{test=0;}var myeltmp=Ext.get(this.calx.id+"-allday"+(i+1));myeltmp.setWidth(Ext.get(this.calx.id+"-wd"+(i+1)).getWidth());}},onWeekHeaderdayClick:function(evx,elx,obx){if(elx.className.indexOf('x-calendar-weekv-header-days')<0){return false;}var tmpobj=Ext.get(elx);var fechatoset=tmpobj.getAttributeNS('tag','dayval');var tmpnewdate=new Date(fechatoset);if(this.headerDayClick=="viewday"){if(this.calx.fireEvent("beforeChangeView",'day','week',this.calx)==false){return false;}else{this.calx.currentdate=tmpnewdate;this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.calx.currentView='day';this.calx.viewday.render();this.calx.fireEvent("onChangeView",'day','week',this);}}else{return false;}},onDblclickSingleday:function(evx,elx,objx){var tmpdata=Ext.get(elx.id);var datatask=this.getTaskarray(elx);this.calx.fireEvent("taskDblClick",datatask,this,this.calx,'week');},onDblclick:function(evx,elx,obx){var tmpdata=Ext.get(elx.id);var datatask=this.getTaskarray(elx);this.calx.fireEvent("taskDblClick",datatask,this,this.calx,'week');},operabuttons_body:function(evx,elx,obx){if(Ext.isOpera){if(evx.button==2){this.oncontextmenu_bodyday(evx,elx,obx);}}},operabuttons:function(evx,elx,obx){if(Ext.isOpera){if(evx.button==2){this.oncontextmenu(evx,elx,obx);}}},onContextTaskMenu_Hide:function(){},onContextHide_newVer:function(obj){if(Ext.version.substr(0,1)=="3"){obj.removeAll();obj.destroy();}},oncontextmenu_bodyday:function(evx,elx,obx){if(Ext.isOpera){if(evx.button!=2){return false;}}if(elx.id.indexOf("containeronday")<0){return false;}if(this.ShowMenuItems[0]!=true&&this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[5]!=true){return false;}if(Ext.isIE){testxxx=Ext.get(elx.parentNode);var datetohandle=testxxx.getAttributeNS('tag','iddate');}else{var testxxx=elx.parentNode;var datetohandle=elx.parentNode.attributes[1].nodeValue;}if(Ext.version.substr(0,1)=="2"){evx.stopEvent();}var tmpdata=Ext.get(elx.id);if(this.menu){this.menu.removeAll();}this.menu=new Ext.menu.Menu({shadow:true,items:[{id:'week_ctxbtn_task-add',iconCls:'x-calendar-day-btnmv_add',text:e2cs.cal_locale.contextMenuLabelsDay.taskAdd,scope:this},'-',{id:'week_ctxbtn_task-go-nd',iconCls:'x-calendar-week-btnmv_nextweek',text:e2cs.cal_locale.contextMenuLabelsWeek.next,scope:this},{id:'week_ctxbtn_task-go-pd',iconCls:'x-calendar-week-btnmv_prevweek',text:e2cs.cal_locale.contextMenuLabelsWeek.prev,scope:this},'-',{id:'week_ctxbtn_viewmonth',iconCls:'x-calendar-month-btnmv_viewmonth',text:e2cs.cal_locale.contextMenuLabelsWeek.chgmview,scope:this},{id:'week_ctxbtn_viewday',iconCls:'x-calendar-month-btnmv_viewday',text:e2cs.cal_locale.contextMenuLabelsWeek.chgdview,scope:this},{id:'week_ctxbtn_viewsched',iconCls:'x-calendar-month-btnmv_viewsched',text:e2cs.cal_locale.contextMenuLabelsWeek.chgsview,scope:this}]});var tmpcalendarobjinstance=this.calx;var mvobjinstance=this;var elementDaybody=elx;this.menu.items.items[0].addListener('click',function(){var daterangestowork=mvobjinstance.getDatesforWeek(new Date(datetohandle));var testnum=elementDaybody.parentNode.id.replace(tmpcalendarobjinstance.id+'-day','');var testnumb=parseInt(testnum)-1;var basedate=daterangestowork[0].add(Date.DAY,testnumb);var calcdate;var tmpYtouse=Ext.get(tmpcalendarobjinstance.id+'-weekbodydisplay').getY();if(Ext.isIE){var mytimeTD_elements=Ext.select('td.hour-marker_ie',true);}else{var mytimeTD_elements=Ext.select('td.hour-marker',true);}mytimeTD_elements.each(function(el,thisobj,index){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-weekv-')+1>=1){var CYtmp=Ext.get(el).getY();var CHtmp=Ext.get(el).getHeight();if(Ext.version.substr(0,1)=="2"){var tmpCurrY=evx.getPageY();}else{if(Ext.isIE){var tmpCurrY=evx.clientY;}else{var tmpCurrY=evx.pageY;}}if(tmpCurrY>=CYtmp&&tmpCurrY<=(CYtmp+CHtmp)){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-weekv-')<0){var mydt_element_test=Ext.get(el).parent().id.replace(tmpcalendarobjinstance.id+'-tdbody-weekv-','');}else{var mydt_element_test=el.id.replace(tmpcalendarobjinstance.id+'-tdbody-weekv-','');}var tmpdatex=mydt_element_test.toUpperCase();if(mvobjinstance.hourFormat=="H"||mvobjinstance.hourFormat=="G"){tmpdatex=tmpdatex.replace('AM','');tmpdatex=tmpdatex.replace('PM','');}else if(mvobjinstance.hourFormat=="h"||mvobjinstance.hourFormat=="g"){var testx=11;}calcdate=new Date(tmpdatex);return false;}else{return true;}}},this);if(Ext.isIE6||Ext.isIE7||Ext.isIE8){if(calcdate!=undefined||calcdate!=null){var rtndate=new Date(basedate.format('m/d/Y')+' '+calcdate.format('H:i:s'));}else{var rtndate=new Date(basedate.format('m/d/Y'));}}else{var rtndate=new Date(basedate.format('m/d/Y')+' '+calcdate.format('H:i:s'));}this.calx.fireEvent("taskAdd",rtndate);},this);this.menu.items.items[2].addListener('click',function(){this.onclicknext_week();},this);this.menu.items.items[3].addListener('click',function(){this.onclickprev_week();},this);this.menu.items.items[5].addListener('click',function(){this.changeCalview(testxxx,this,1);},this);this.menu.items.items[6].addListener('click',function(){this.changeCalview(testxxx,this,2);},this);this.menu.items.items[7].addListener('click',function(){this.changeCalview(testxxx,this,3);},this);if(this.ShowMenuItems[0]!=true){this.menu.items.items[0].hidden=true;this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[5]!=true){this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true){this.menu.items.items[2].hidden=true;}if(this.ShowMenuItems[2]!=true){this.menu.items.items[3].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true){this.menu.items.items[4].hidden=true;}if(this.ShowMenuItems[3]!=true){this.menu.items.items[5].hidden=true;}if(this.ShowMenuItems[4]!=true){this.menu.items.items[6].hidden=true;}if(this.ShowMenuItems[5]!=true){this.menu.items.items[7].hidden=true;}if(!this.calx.mview){this.menu.items.items[6].hidden=true;}if(!this.calx.dview){this.menu.items.items[5].hidden=true;}if(!this.calx.sview){this.menu.items.items[7].hidden=true;}if(Ext.version.substr(0,1)=="2"){this.menu.on('hide',this.onContextTaskMenu_Hide,this);this.menu.showAt([evx.getPageX(),evx.getPageY()]);}else{this.menu.on('hide',this.onContextHide_newVer,this);this.menu.showAt([evx.clientX,evx.clientY]);}},changeCalview:function(objx,mviewx,typeview){if(Ext.isIE){var refdate=objx.getAttributeNS('tag','iddate');}else{var refdate=objx.attributes[1].nodeValue;}this.calx.currentdate=new Date(refdate);this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);if(typeview==1){varview='month';}else if(typeview==2){varview='day';}else{varview='schedule';}this.calx.changeView(varview);},oncontextmenu:function(evx,elx,obx){if(Ext.isOpera){if(evx.button!=2){return false;}}if(this.task_ShowMenuItems[0]!=true&&this.task_ShowMenuItems[1]!=true&&this.task_ShowMenuItems[2]!=true&&this.task_ShowMenuItems[3]!=true&&this.task_ShowMenuItems[4]!=true&&this.moreMenuItems.length<=0){return false;}if(Ext.version.substr(0,1)=="2"){evx.stopEvent();}if(elx.id.indexOf(this.calx.id+'-ecal-daytask-')<0){if(elx.id.indexOf(this.calx.id+'-ecal-alldaytask-')<0){var tmpdata=Ext.get(elx.parentNode.id);}else{var tmpdata=Ext.get(elx.id);}}else{var tmpdata=Ext.get(elx.id);}var toshowOnCXmenu=this.task_ShowMenuItems;var newmenuitems=this.moreMenuItems;var actionsTaskCX=[];var dataTASKtmp=this.getTaskarray(tmpdata);var testevent=this.calx.fireEvent("beforeContextMenuTask","weekview-task",dataTASKtmp,toshowOnCXmenu,actionsTaskCX);if(testevent==false){if(actionsTaskCX[0]==false){if(actionsTaskCX[1]==true){if(actionsTaskCX[2]==true){var newmenuitems=actionsTaskCX[3];}var toshowOnCXmenu=actionsTaskCX[4];}else{var newmenuitems=this.moreMenuItems;var toshowOnCXmenu=this.task_ShowMenuItems;}}else{return false;}}else{var newmenuitems=this.moreMenuItems;}if(this.menu){this.menu.removeAll();}this.menu=new Ext.menu.Menu({shadow:true,items:[{id:'week_ctxbtn_task-add',iconCls:'x-calendar-day-btnmv_add',text:e2cs.cal_locale.contextMenuLabelsDay.taskAdd,scope:this},{id:'week_ctxbtn_task-delete',iconCls:'x-calendar-day-btnmv_delete',text:e2cs.cal_locale.contextMenuLabelsDay.taskDelete,scope:this},'-',{id:'week_ctxbtn_task-edit',iconCls:'x-calendar-day-btnmv_task',text:e2cs.cal_locale.contextMenuLabelsDay.taskEdit+tmpdata.getAttributeNS('tag','ec_subject'),scope:this},'-',{id:'week_ctxbtn_task-go-nw',iconCls:'x-calendar-week-btnmv_nextweek',text:e2cs.cal_locale.contextMenuLabelsWeek.next,scope:this},{id:'week_ctxbtn_task-go-pw',iconCls:'x-calendar-week-btnmv_prevweek',text:e2cs.cal_locale.contextMenuLabelsWeek.prev,scope:this}]});if(newmenuitems.length>0){this.menu.add('-');for(var i=0;i<newmenuitems.length;i++){newmenuitems[i].rendered=false;if(newmenuitems[i].menu==undefined){if(newmenuitems[i].ctype=="Ext.menu.Item"){if(newmenuitems[i].hasListener('click')){newmenuitems[i].purgeListeners();}newmenuitems[i].addListener('click',function(parx,parz){this.onCustomMenuAction(parx.id,Ext.get(elx),this);},this);}else{}this.menu.add(newmenuitems[i]);}else{for(var xm=0;xm<newmenuitems[i].menu.items.length;xm++){newmenuitems[i].menu.items.items[xm].rendered=false;if(newmenuitems[i].menu.items.items[xm].ctype=="Ext.menu.Item"){if(newmenuitems[i].menu.items.items[xm].hasListener('click')){newmenuitems[i].menu.items.items[xm].purgeListeners();}newmenuitems[i].menu.items.items[xm].addListener('click',function(parx,parz){this.onCustomMenuAction(parx.id,Ext.get(elx),this);},this);}else{}}this.menu.add(newmenuitems[i]);}}}this.menu.items.items[0].addListener('click',function(){this.onActionTask(1,Ext.get(elx),this);},this);this.menu.items.items[1].addListener('click',function(){this.onActionTask(2,Ext.get(elx),this);},this);this.menu.items.items[3].addListener('click',function(){this.onActionTask(3,Ext.get(elx),this);},this);this.menu.items.items[5].addListener('click',function(){this.onclicknext_week();},this);this.menu.items.items[6].addListener('click',function(){this.onclickprev_week();},this);if(toshowOnCXmenu[0]!=true){this.menu.items.items[0].hidden=true;}if(toshowOnCXmenu[1]!=true){this.menu.items.items[1].hidden=true;}if(toshowOnCXmenu[0]!=true&&toshowOnCXmenu[1]!=true){this.menu.items.items[2].hidden=true;}if(toshowOnCXmenu[2]!=true&&toshowOnCXmenu[3]!=true&&toshowOnCXmenu[4]!=true&&newmenuitems.length<=0){this.menu.items.items[2].hidden=true;}if(toshowOnCXmenu[2]!=true){this.menu.items.items[3].hidden=true;this.menu.items.items[4].hidden=true;}if(toshowOnCXmenu[3]!=true&&toshowOnCXmenu[4]!=true&&newmenuitems.length<=0){this.menu.items.items[4].hidden=true;}if(toshowOnCXmenu[3]!=true){this.menu.items.items[5].hidden=true;}if(toshowOnCXmenu[4]!=true){this.menu.items.items[6].hidden=true;}if(newmenuitems.length>0){if(toshowOnCXmenu[3]!=true&&toshowOnCXmenu[4]!=true){this.menu.items.items[7].hidden=true;}}if(Ext.version.substr(0,1)=="2"){this.menu.on('hide',this.onContextTaskMenu_Hide,this);this.menu.showAt([evx.getPageX(),evx.getPageY()]);}else{this.menu.on('hide',this.onContextHide_newVer,this);this.menu.showAt([evx.clientX,evx.clientY]);}},onCustomMenuAction:function(MenuId,taskEl,TaskObj){var datatask=this.getTaskarray(taskEl);this.calx.fireEvent("customMenuAction",MenuId,'week',datatask,taskEl,this);this.menu.hide();},onActionTask:function(action,taskEl,TaskObj){var datatask=this.getTaskarray(taskEl);switch(action){case 1:if(taskEl.id.indexOf(this.calx.id+"-ecal-alldaytask")>=0){this.calx.fireEvent("taskAdd",this.calx.currentdate);}else{if(Ext.isIE){testxxx=Ext.get(taskEl.dom.parentNode.parentNode);var datewday=new Date(testxxx.getAttributeNS('tag','iddate'));}else{var datewday=new Date(taskEl.dom.parentNode.parentNode.attributes[1].nodeValue);}this.calx.fireEvent("taskAdd",datewday);}break;case 2:var check=this.calx.fireEvent("beforeTaskDelete",datatask,this);if(check){if(this.calx.fireEvent("onTaskDelete",datatask)==true){this.calx.fireEvent("afterTaskDelete",datatask,true);}else{this.calx.fireEvent("afterTaskDelete",null,false);}}break;case 3:var check=this.calx.fireEvent("beforeTaskEdit",datatask,this);if(check){if(this.calx.fireEvent("onTaskEdit",datatask)==true){this.calx.fireEvent("afterTaskEdit",datatask,true);}else{this.calx.fireEvent("afterTaskEdit",null,false);}}break;default:break;}},getTaskarray:function(TaskElx){var tmpdata=Ext.get(TaskElx);var datatask=[];datatask[0]=tmpdata.getAttributeNS('tag','id');datatask[1]=tmpdata.getAttributeNS('tag','ec_id');datatask[2]=tmpdata.getAttributeNS('tag','ec_subject');datatask[3]=tmpdata.getAttributeNS('tag','ec_starts');datatask[4]=tmpdata.getAttributeNS('tag','ec_ends');datatask[5]=tmpdata.getAttributeNS('tag','ec_cnt');datatask[6]=tmpdata.getAttributeNS('tag','ec_storeindex');datatask[7]=tmpdata.getAttributeNS('tag','ec_location');datatask[8]=tmpdata.getAttributeNS('tag','ec_allday');datatask[9]=tmpdata.getAttributeNS('tag','ec_isholiday');return datatask;},getDatesforWeek:function(Dateval){var dw=new Date(Dateval).getDay();if(this.startDay==1){dw=((dw==0)?6:dw-1);var initdate=new Date(Dateval.add(Date.DAY,-dw).format('m/d/Y')+' '+this.startTime);var enddate=new Date(Dateval.add(Date.DAY,-dw+6).format('m/d/Y')+' '+this.endTime);}else if(this.startDay==0){if(dw==0){var initdate=new Date(Dateval.add(Date.DAY,0).format('m/d/Y')+' '+this.startTime);var enddate=new Date(Dateval.add(Date.DAY,6).format('m/d/Y')+' '+this.endTime);}else{var initdate=new Date(Dateval.add(Date.DAY,-(dw)).format('m/d/Y')+' '+this.startTime);var enddate=new Date(initdate.add(Date.DAY,6).format('m/d/Y')+' '+this.endTime);}}else{if(dw==6){var initdate=new Date(Dateval.add(Date.DAY,0).format('m/d/Y')+' '+this.startTime);var enddate=new Date(Dateval.add(Date.DAY,6).format('m/d/Y')+' '+this.endTime);}else{var initdate=new Date(Dateval.add(Date.DAY,-(dw+1)).format('m/d/Y')+' '+this.startTime);var enddate=new Date(initdate.add(Date.DAY,6).format('m/d/Y')+' '+this.endTime);}}return[initdate,enddate];},getWeekTasks:function(Dateval,Type){var daterange=this.getDatesforWeek(this.datetohandle);var tmpdaytasks=[];switch(Type){case 0:var numrecs=this.calx.store.getCount();var countdone=0;var datexxa=new Date(Dateval.format('m/d/Y')+' '+this.startTime);var datexxb=new Date(Dateval.format('m/d/Y')+' '+this.endTime);var minutesPerDay=this.calx.dateDiff(datexxa,datexxb,e2cs.dateParts.MINUTE);for(var i=0;i<numrecs;i++){var testrec=this.calx.store.getAt(i).data;tstdateini=new Date(testrec[this.calx.fieldsRefer.startdate]);tstdateend=new Date(testrec[this.calx.fieldsRefer.enddate]);if(testrec[this.calx.fieldsRefer.alldaytask]){if(tstdateini.between(daterange[0],daterange[1])||tstdateend.between(daterange[0],daterange[1])){tmpdaytasks[countdone]=testrec;countdone+=1;}}else{var testminutes=this.calx.dateDiff(tstdateini,tstdateend,e2cs.dateParts.MINUTE);if(testminutes>=minutesPerDay){if(this.allday24HinsideBody==true&&testminutes==minutesPerDay){if(tstdateini<daterange[0]&&tstdateend>daterange[1]){var testdiffc=tstdateend.add(Date.SECOND,-1);if(tstdateini.format('m/d/Y')==testdiffc.format('m/d/Y')){}else{tmpdaytasks[countdone]=testrec;countdone+=1;}}else{if(tstdateini.between(daterange[0],daterange[1])||tstdateend.between(daterange[0],daterange[1])){var testdiffc=tstdateend.add(Date.SECOND,-1);if(tstdateini.format('m/d/Y')==testdiffc.format('m/d/Y')){}else{tmpdaytasks[countdone]=testrec;countdone+=1;}}}}else{if(tstdateini<daterange[0]&&tstdateend>daterange[1]){tmpdaytasks[countdone]=testrec;countdone+=1;}else{if(tstdateini.between(daterange[0],daterange[1])||tstdateend.between(daterange[0],daterange[1])){tmpdaytasks[countdone]=testrec;countdone+=1;}}}}else{}}}break;case 1:var dateinionthisday=new Date(Dateval.format('m/d/Y')+' '+this.startTime);var dateendonthisday=new Date(Dateval.format('m/d/Y')+' '+this.endTime);var numrecs=this.calx.store.getCount();var countdone=0;var minutesPerDay=this.calx.dateDiff(dateinionthisday,dateendonthisday,e2cs.dateParts.MINUTE);for(var i=0;i<numrecs;i++){var testrec=this.calx.store.getAt(i).data;tstdateini=new Date(testrec[this.calx.fieldsRefer.startdate]);tstdateend=new Date(testrec[this.calx.fieldsRefer.enddate]);var testminutes=this.calx.dateDiff(tstdateini,tstdateend,e2cs.dateParts.MINUTE);if(tstdateini<dateinionthisday&&tstdateend>dateendonthisday){}else if(tstdateini.format('m/d/Y')==dateinionthisday.format('m/d/Y')&&testminutes<minutesPerDay){if(tstdateini.between(dateinionthisday,dateendonthisday)||tstdateend.between(dateinionthisday,dateendonthisday)){if(testrec[this.calx.fieldsRefer.alldaytask]!=true){tmpdaytasks[countdone]=testrec;countdone+=1;}}}else if(tstdateend.format('m/d/Y')==dateinionthisday.format('m/d/Y')&&testminutes<minutesPerDay){if(tstdateini.between(dateinionthisday,dateendonthisday)||tstdateend.between(dateinionthisday,dateendonthisday)){if(testrec[this.calx.fieldsRefer.alldaytask]!=true){tmpdaytasks[countdone]=testrec;countdone+=1;}}}else{if(tstdateini.format('m/d/Y')==Dateval.format('m/d/Y')){var testdiffc=tstdateend.add(Date.SECOND,-1);if(tstdateini.format('m/d/Y')==testdiffc.format('m/d/Y')){var testminutesonthisday=this.calx.dateDiff(tstdateini,tstdateend,e2cs.dateParts.MINUTE);if(minutesPerDay==testminutesonthisday){if(this.allday24HinsideBody==true){tmpdaytasks[countdone]=testrec;countdone+=1;}}}}}}break;case 2:var dateinionthisday=new Date(Dateval.format('m/d/Y')+' '+this.startTime);var dateendonthisday=new Date(Dateval.format('m/d/Y')+' '+this.endTime);var numrecs=this.calx.store.getCount();var countdone=0;for(var i=0;i<numrecs;i++){var testrec=this.calx.store.getAt(i).data;tstdateini=new Date(testrec[this.calx.fieldsRefer.startdate]);tstdateend=new Date(testrec[this.calx.fieldsRefer.enddate]);checkdates=this.datetohandle.between(new Date(tstdateini),new Date(tstdateend));chkformat=this.datetohandle.format('m/d/Y');test=new Date(dateinit);if(test.format('m/d/Y')==chkformat){checkdates=true;}test=new Date(dateend);if(test.format('m/d/Y')==chkformat){checkdates=true;}var check=this.calx.dateDiff(tstdateini,tstdateend,e2cs.dateParts.DAY);if(check<1){if(tstdateini.between(dateinionthisday,dateendonthisday)&&tstdateend.between(dateinionthisday,dateendonthisday)){tmpdaytasks[countdone]=testrec;countdone+=1;}}else{if(check>=1){if(tstdateini<dateinionthisday&&tstdateend>dateendonthisday){tmpdaytasks[countdone]=testrec;countdone+=1;}else{if(tstdateini.between(dateinionthisday,dateendonthisday)||tstdateend.between(dateinionthisday,dateendonthisday)){tmpdaytasks[countdone]=testrec;countdone+=1;}}}}}break;default:tmpdaytasks=[];break;}return tmpdaytasks;},showMoreTasksList:function(){taskstmp=this.getWeekTasks(this.datetohandle,0);showdata=[];for(var i=0;i<taskstmp.length;i++){showdata[i]=[taskstmp[i][this.calx.fieldsRefer.id],taskstmp[i][this.calx.fieldsRefer.subject],taskstmp[i][this.calx.fieldsRefer.description],taskstmp[i][this.calx.fieldsRefer.startdate],taskstmp[i][this.calx.fieldsRefer.enddate],taskstmp[i][this.calx.fieldsRefer.color],taskstmp[i][this.calx.fieldsRefer.location],taskstmp[i][this.calx.fieldsRefer.isHoliday],taskstmp[i][this.calx.fieldsRefer.alldaytask]];}if(this.alldayTaksMore=="event"){this.fireEvent("launchEventList",showdata[i]);return false;}else if(this.alldayTaksMore=="window"){var reader=new Ext.data.ArrayReader({},[{name:this.calx.fieldsRefer.id,type:'int'},{name:this.calx.fieldsRefer.subject,type:'string'},{name:this.calx.fieldsRefer.description,type:'string'},{name:this.calx.fieldsRefer.startdate,type:'string'},{name:this.calx.fieldsRefer.enddate,type:'string'},{name:this.calx.fieldsRefer.color,type:'string'},{name:this.calx.fieldsRefer.location,type:'string'},{name:this.calx.fieldsRefer.isHoliday,type:'boolean'},{name:this.calx.fieldsRefer.alldaytask,type:'boolean'}]);tmpstore=new Ext.data.Store({reader:reader,data:showdata});tmppanel=new Ext.Panel({id:'ecal-more-task-panel',header:false,autoDestroy:true,autoScroll:true,monitorResize:true,border:false,autoWidth:false,autoHeight:false,items:new Ext.DataView({loadingText:e2cs.cal_locale.win_tasks_loading,store:tmpstore,tpl:this.alldayTaskTPL,autoWidth:true,autoHeight:true,overClass:'',itemSelector:'',emptyText:e2cs.cal_locale.win_tasks_empty})});var ecalwinshowmore=new Ext.Window({id:'ecal-win-moretasks',name:'ecal-win-moretasks',title:e2cs.cal_locale.win_week_zoomlabel,width:450,height:300,closeAction:'close',resizable:true,resizeHandles:'all',hideBorders:true,maximizable:true,plain:true,modal:true,layout:'fit',iconCls:'x-calendar-more-tasks-win',items:[tmppanel]});ecalwinshowmore.show();}},formatdayTask:function(dateval,numday,ExtEl,indexElperDay){if(this.style=='plain'){var totaltasksinday=this.getWeekTasks(dateval,2);}else{var totaltasksinday=this.getWeekTasks(dateval,1);}var totaltasks=totaltasksinday.length;var container=Ext.get(this.calx.id+'-day'+numday);var m_starttime=dateval.format('m/d/Y ')+this.startTime;var m_endtime=dateval.format('m/d/Y ')+this.endTime;this.totalhours=this.calx.dateDiff(new Date(m_starttime),new Date(m_endtime),e2cs.dateParts.HOUR);var inittimetask=this.checkTasktime(ExtEl.getAttributeNS('tag','ec_starts'));var endtimetask=this.checkTasktime(ExtEl.getAttributeNS('tag','ec_ends'));var diffstartinipos=this.calx.dateDiff(new Date(m_starttime),new Date(inittimetask),e2cs.dateParts.MINUTE);if(diffstartinipos<0){initpos=0;flagstarttasttext=e2cs.cal_locale.task_LessDaysFromTask;}else{initpos=diffstartinipos;flagstarttasttext='';}var diffendpos=this.calx.dateDiff(new Date(m_endtime),new Date(endtimetask),e2cs.dateParts.MINUTE);if(diffendpos>0){endpos=(this.totalhours+1)*60;endpos=Math.abs(initpos-endpos);flagendtasttext=e2cs.cal_locale.task_MoreDaysFromTask;}else{var tmpdate=new Date(inittimetask);var dtstartday=new Date(dateval.format('m/d/Y')+' '+this.startTime);if(tmpdate<dtstartday){endpos=this.calx.dateDiff(new Date(m_starttime),new Date(endtimetask),e2cs.dateParts.MINUTE);}else{endpos=this.calx.dateDiff(new Date(inittimetask),new Date(endtimetask),e2cs.dateParts.MINUTE);}if(endpos==(this.totalhours*60)){endpos=endpos;}else if(endpos>(this.totalhours*60)){endpos=(this.totalhours*60);}flagendtasttext='';}ExtEl.setHeight(endpos,false);if(this.forceTaskFit){var ancho=98/totaltasks;ExtEl.setStyle({width:''+ancho+'%'});if(Ext.version.substr(0,1)=="2"){ExtEl.setStyle({left:''+(ancho*indexElperDay)+'%'});}else{ExtEl.setStyle({left:''+(0)+'%'});ExtEl.setStyle("float",'left');}}else{ExtEl.setWidth(this.task_width,false);if(Ext.isOpera){var testwxopera=(indexElperDay+1)*this.task_width;if(((indexElperDay+1)*this.task_width)>container.getWidth(false)){ExtEl.setStyle('display','none');}if((indexElperDay+1)>1){ExtEl.setLeft('0px');}}else{ExtEl.setLeft(''+(indexElperDay*this.task_width)+'px');}}if(Ext.isOpera){ExtEl.setY(container.getY()+initpos);ExtEl.setStyle({top:''+initpos+'px'});ExtEl.setStyle("float",'left');}else{ExtEl.setY(container.getY()+initpos);}if(Ext.isIE){ExtEl.setStyle('z-index','2000');}else{ExtEl.setStyle('z-index','auto');}},checkTasktime:function(taskvalue){if(taskvalue instanceof Date){var tochecktmpdt=taskvalue.format('m/d/Y G:i');}else{var tochecktmpdt=taskvalue;}var test=tochecktmpdt.indexOf(":",0);if(test<=0){taskvaluefix=tochecktmpdt+' '+this.startTime;}else{taskvaluefix=tochecktmpdt;}return taskvaluefix;},getstartdayelements:function(range,datedt){var check=0;for(var i=0;i<7;i++){var checkdt=range[0].add(Date.DAY,i);if(checkdt.format('m/d/Y')==datedt.format('m/d/Y')){check=i;break;}}check+=1;return check;},formatallDayTask:function(ExtEl){var daterange=this.getDatesforWeek(this.datetohandle);var initdateEl=new Date(ExtEl.getAttributeNS('tag','ec_starts'));var enddateEl=new Date(ExtEl.getAttributeNS('tag','ec_ends'));var diffElDays=this.calx.dateDiff(initdateEl,enddateEl,e2cs.dateParts.DAY);if(diffElDays>7){diffElDays=7;}var checkdate=new Date(initdateEl.format('m/d/Y ')+this.startTime);initdaystart=this.calx.dateDiff(daterange[0],checkdate,e2cs.dateParts.DAY);if(initdaystart<0){diffElDays=this.calx.dateDiff(daterange[0],enddateEl,e2cs.dateParts.DAY);if(diffElDays>7){diffElDays=7;}initdaystart=0;}var myallcontainer=Ext.get(this.calx.id+'-alldaycontainer');newposx=0;var tmpinitcountwx=this.getstartdayelements(daterange,initdateEl);initdaystart+=tmpinitcountwx;for(var i=1;i<tmpinitcountwx;i++){if(i>7){break;}newposx+=Ext.get(this.calx.id+'-allday'+(i+1)).getWidth(true);}if(Ext.isIE){ExtEl.setX(myallcontainer.getX()+newposx);}else{ExtEl.setX(Ext.get(this.calx.id+'-allday'+tmpinitcountwx).getX());}ancho=0;if(enddateEl>daterange[1]){var countdays=0;var welstoget=this.getAnchoalldaytoUse(initdateEl,enddateEl);var tmpinitcountwx=this.getstartdayelements(daterange,initdateEl);welstoget+=tmpinitcountwx;for(var i=tmpinitcountwx;i<welstoget;i++){if(i>7){break;}ancho+=Ext.get(this.calx.id+'-allday'+(i)).getWidth(false);countdays+=1;}if(Ext.isIE){countdays=-1;}ExtEl.setWidth(ancho+(countdays-1),false);}else{var countdays=0;if(diffElDays<=1){var datexx1=new Date(initdateEl.format('m/d/Y G:i:s'));var datexx2=new Date(enddateEl.format('m/d/Y G:i:s'));var testdiff=new Date(datexx2).add(Date.SECOND,-1);if(initdateEl.format('m/d/Y')==testdiff.format('m/d/Y')){ancho+=Ext.get(this.calx.id+'-allday1').getWidth(false);}else if(initdateEl.format('m/d/Y')!=enddateEl.format('m/d/Y')){var welstoget=this.getAnchoalldaytoUse(initdateEl,enddateEl);var tmpinitcountwx=this.getstartdayelements(daterange,initdateEl);welstoget+=tmpinitcountwx;for(var i=tmpinitcountwx;i<welstoget;i++){if(i>7){break;}ancho+=Ext.get(this.calx.id+'-allday'+(i)).getWidth(false);countdays+=1;}}}else{var welstoget=this.getAnchoalldaytoUse(initdateEl,enddateEl);var tmpinitcountwx=this.getstartdayelements(daterange,initdateEl);welstoget+=tmpinitcountwx;var countdays=0;for(var i=tmpinitcountwx;i<welstoget;i++){if(i>7){break;}ancho+=Ext.get(this.calx.id+'-allday'+(i)).getWidth(false);countdays+=1;}}if(Ext.isIE){countdays=countdays*-1-1;}ExtEl.setWidth(ancho+(countdays-1),false);}},getAnchoalldaytoUse:function(DateX,DateZ){var daterange=this.getDatesforWeek(this.datetohandle);count=0;countxx=0;var micampocompara=DateZ.format('m/d/Y');if(DateX<=daterange[0]){var datetoinit=daterange[0];}else{var datetoinit=DateX;}while(countxx<99999){testdata=new Date(datetoinit).add(Date.DAY,count);varprueba=testdata.format('m/d/Y');var compara=micampocompara;count+=1;if(varprueba==compara){break;}countxx+=1;}return count;},onclickprev_week:function(){var newdate=this.datetohandle.add(Date.DAY,+(-7));var check=this.fireEvent("beforeWeekChange",this.datetohandle,newdate);if(check){this.datetohandle=newdate;this.calx.currentdate=newdate;this.render();this.fireEvent("afterWeekChange",newdate);}},onclicknext_week:function(){var newdate=this.datetohandle.add(Date.DAY,+(+7));var check=this.fireEvent("beforeWeekChange",this.datetohandle,newdate);if(check){this.datetohandle=newdate;this.calx.currentdate=newdate;this.render();this.fireEvent("afterWeekChange",newdate);}},genDaysHeader:function(datestart){var htmlheader='';htmlheader='<div id="'+this.calx.id+'-allday_w_task" class="allday_w_task">';htmlheader+='<div id="'+this.calx.id+'-alldaygridbodylayout" class="alldaygridbody">';htmlheader+='<table width="100%" border="1" cellpadding="0" cellspacing="1" bordercolor="#004E9B" bgcolor="#004E9B"><tr>';htmlheader+='<td width="50"><table width="50" border="0" align="center" cellpadding="0" cellspacing="0">';htmlheader+='<tr><td width="50" class="allday-marker" id="alldayrefer" ><div class="taskallday-layoutbase">&nbsp;</div>';htmlheader+='</td></tr></table></td>';for(var i=0;i<7;i++){var daylabel=datestart.add(Date.DAY,i).format(this.dayformatLabel);var validtd=datestart.add(Date.DAY,i).format('m/d/Y');htmlheader+='<td valign="top"  class="x-calendar-weekv-header-days" dayval="'+validtd+'" id="'+this.calx.id+'-weekhdrday-'+(i+1)+'">'+daylabel+'</td>';}htmlheader+='</tr></table></div></div>';return htmlheader;},genAlldayContainer:function(datestart){var htmlcontainer='';htmlcontainer+='<div id="'+this.calx.id+'-alldaycontainer" class="allday-container">';var taskstmp=this.getWeekTasks(this.datetohandle,0);if(taskstmp.length==0){htmlcontainer+='&nbsp;';}else{if(taskstmp.length<=this.alldayTasksMaxView){tasktoshow=taskstmp.length;}else{tasktoshow=this.alldayTasksMaxView;}for(var j=0;j<tasktoshow;j++){var fch_starts=new Date(taskstmp[j][this.calx.fieldsRefer.startdate]);var fch_ends=new Date(taskstmp[j][this.calx.fieldsRefer.enddate]);var tmpdescription=taskstmp[j][this.calx.fieldsRefer.description];if(tmpdescription.length>this.calx.tipmaxLength){var tmpdescriptionx=tmpdescription.substring(0,this.calx.tipmaxLength)+'...';}else{var tmpdescriptionx=tmpdescription;}var datatip={starxl:e2cs.cal_locale.task_qtip_starts,startval:fch_starts.format(this.task_format),endxl:e2cs.cal_locale.task_qtip_ends,endval:fch_ends.format(this.task_format),details:tmpdescriptionx,location:taskstmp[j][this.calx.fieldsRefer.location],alldaytask:taskstmp[j][this.calx.fieldsRefer.alldaytask],isHoliday:taskstmp[j][this.calx.fieldsRefer.isHoliday]};var newqtip=this.calx.tplTaskTip.apply(datatip);htmlcontainer+='<div id="'+this.calx.id+'-ecal-alldaytask-'+j+'" class="taskallday-taskbase"  style="background-color:'+taskstmp[j][this.calx.fieldsRefer.color]+'"';htmlcontainer+='ext:qtitle="'+taskstmp[j][this.calx.fieldsRefer.subject]+'" ext:qtip="'+newqtip+'"';htmlcontainer+='ec_id="'+taskstmp[j][this.calx.fieldsRefer.id]+'" ec_starts="'+taskstmp[j][this.calx.fieldsRefer.startdate]+'"';htmlcontainer+='ec_ends="'+taskstmp[j][this.calx.fieldsRefer.enddate]+'" ec_subject="'+taskstmp[j][this.calx.fieldsRefer.subject]+'"';htmlcontainer+='ec_cnt="'+taskstmp[j][this.calx.fieldsRefer.description]+'" ec_storeindex="'+j+'" ';htmlcontainer+='ec_location="'+taskstmp[j][this.calx.fieldsRefer.location]+'" ';htmlcontainer+='ec_allday="'+taskstmp[j][this.calx.fieldsRefer.alldaytask]+'" ';htmlcontainer+='ec_isholiday="'+taskstmp[j][this.calx.fieldsRefer.isHoliday]+'">';htmlcontainer+=taskstmp[j][this.calx.fieldsRefer.subject]+'</div>';}}htmlcontainer+='</div>';htmlcontainer+='<div id="'+this.calx.id+'-allday_w_task" class="allday_w_task">';htmlcontainer+='<div id="'+this.calx.id+'-alldaygridbodylayout" class="alldaygridbody">';htmlcontainer+='<table id="'+this.calx.id+'-tableallcontainer" width="100%" border="0" ';htmlcontainer+='cellpadding="0" cellspacing="0" bordercolor="#004E9B" bgcolor="#004E9B"><tr>';if(Ext.isIE){var anchostr='51';}else{var anchostr='51';}htmlcontainer+='<td class="" width="50">&nbsp;</td>';for(var i=0;i<7;i++){var daylabel=datestart.add(Date.DAY,i).format(this.dayformatLabel);var validtd=datestart.add(Date.DAY,i).format('m/d/Y');htmlcontainer+='<td valign="top"  class="x-calendar-weekv-header-days" dayval="'+validtd+'" id="'+this.calx.id+'-weekhdrday-'+(i+1)+'">'+daylabel+'</td>';}htmlcontainer+='</tr><tr><td>';htmlcontainer+='<table width="'+anchostr+'" border="0" align="center" cellpadding="0" cellspacing="0">';htmlcontainer+='<tr><td width="50" class="allday-marker" id="alldayrefer" >';if(taskstmp.length){if(taskstmp.length<=this.alldayTasksMaxView){tasktoshow=taskstmp.length;}else{tasktoshow=this.alldayTasksMaxView;}for(var i=0;i<tasktoshow;i++){htmlcontainer+='<div class="taskallday-layoutbase">&nbsp;</div>';}}else{htmlcontainer+='<div class="taskallday-layoutbase">&nbsp;</div>';htmlcontainer+='<div class="taskallday-layoutbase">&nbsp;</div>';}htmlcontainer+='</td></tr></table></td>';for(var i=0;i<7;i++){todaytmp=new Date();gendatetd=datestart.add(Date.DAY,i);var daylabel=gendatetd.format(this.dayformatLabel);if(i==0){htmlcontainer+='<td width="14%" bgcolor="#FFFFFF" valign="top" class="weekstartday" id="'+this.calx.id+'-allday'+(i+1)+'"><div>&nbsp;</div></td>';}else if(i==6){htmlcontainer+='<td width="14%" bgcolor="#FFFFFF" valign="top" class="weekendday" id="'+this.calx.id+'-allday'+(i+1)+'"><div>&nbsp;</div></td>';}else{htmlcontainer+='<td width="14%" bgcolor="#FFFFFF" valign="top" class="weekmidday" id="'+this.calx.id+'-allday'+(i+1)+'"><div>&nbsp;</div></td>';}}htmlcontainer+='</tr></table></div></div>';htmlcontainer+='<div id="alldaylistbutton" class="x-calendar-weekv-header-alldaylist">';htmlcontainer+=e2cs.cal_locale.alldayTasksMaxLabel+' </div>';return htmlcontainer;},genBody:function(datestart){var dt=new Date(datestart);var inittime=new Date(dt.format('m/d/Y')+' '+this.startTime);var endtime=new Date(dt.format('m/d/Y')+' '+this.endTime);this.diffhrs=this.calx.dateDiff(inittime,endtime,e2cs.dateParts.HOUR);var dviewbody='<div id="'+this.calx.id+'-weekbodydisplay" class="weekbodydisplay">';var wtdisp='';if(Ext.isIE||Ext.isIE6){mydatacomp=' style="position:relative;" ';wtdisp='97';}else{mydatacomp='';wtdisp='100';}wtdisp='100';dviewbody+='<div id="'+this.calx.id+'-tableweek-layout">';dviewbody+='<table id="'+this.calx.id+'-week-skeleton" width="'+wtdisp+'%" border="0" cellspacing="0" cellpadding="0"'+mydatacomp+'>';dviewbody+='<tr><td width="50"><table width="50" border="0" align="center" cellpadding="0" cellspacing="0">';for(var i=0;i<this.diffhrs;i++){tmpdatetohandleontd=dt.format('m/d/Y');tmpdatetohandleontd+=' '+inittime.add(Date.HOUR,(i)).format('G');tmpdatetohandleontd+=':'+inittime.add(Date.HOUR,(i)).format('i');if(Ext.isIE){var mymarker='hour-marker_ie';}else{var mymarker='hour-marker';}dviewbody+='<tr><td id="'+this.calx.id+'-tdbody-weekv-'+tmpdatetohandleontd+'" class="'+mymarker+'">';dviewbody+='<span>'+inittime.add(Date.HOUR,(i)).format(this.hourFormat)+'</span></td></tr>';}dviewbody+='</table></td>';for(var i=0;i<7;i++){gendatetddiv=datestart.add(Date.DAY,i);if(i==0){dviewbody+='<td width="14%" valign="top" class="weekstartday" id="'+this.calx.id+'-wd'+(i+1)+'">';}else if(i==6){dviewbody+='<td width="14%" valign="top" class="weekendday" id="'+this.calx.id+'-wd'+(i+1)+'">';}else{dviewbody+='<td width="14%" valign="top" class="weekmidday" id="'+this.calx.id+'-wd'+(i+1)+'">';}var tdydate=new Date();if(gendatetddiv.format('m/d/Y')==tdydate.format('m/d/Y')){dviewbody+='<div id="'+this.calx.id+'-day'+(i+1)+'" iddate="'+gendatetddiv.format('m/d/Y')+'" class="currentday"'+mydatacomp+'>';}else{dviewbody+='<div id="'+this.calx.id+'-day'+(i+1)+'" iddate="'+gendatetddiv.format('m/d/Y')+'" class="basegridweek"'+mydatacomp+'>';}if(this.style=='plain'){var tasksinday=this.getWeekTasks(gendatetddiv,2);}else{var tasksinday=this.getWeekTasks(gendatetddiv,1);}if(tasksinday.length==0){dviewbody+='<div id="containeronday" class="containeronday"'+mydatacomp+'>';dviewbody+='&nbsp;';dviewbody+='</div>';}else{dviewbody+='<div id="containeronday" class="containeronday"'+mydatacomp+'>';for(var j=0;j<tasksinday.length;j++){var fch_starts=new Date(tasksinday[j][this.calx.fieldsRefer.startdate]);var fch_ends=new Date(tasksinday[j][this.calx.fieldsRefer.enddate]);var qtiptext='';if(this.task_showqtip){var tmpdescription=tasksinday[j][this.calx.fieldsRefer.description];if(tmpdescription.length>this.calx.tipmaxLength){var tmpdescriptionx=tmpdescription.substring(0,this.calx.tipmaxLength)+'...';}else{var tmpdescriptionx=tmpdescription;}var datatip={starxl:e2cs.cal_locale.task_qtip_starts,startval:fch_starts.format(this.task_format),endxl:e2cs.cal_locale.task_qtip_ends,endval:fch_ends.format(this.task_format),details:tmpdescriptionx,location:tasksinday[j][this.calx.fieldsRefer.location],alldaytask:tasksinday[j][this.calx.fieldsRefer.alldaytask],isHoliday:tasksinday[j][this.calx.fieldsRefer.isHoliday]};var newqtip=this.calx.tplTaskTip.apply(datatip);qtiptext='ext:qtitle="'+tasksinday[j][this.calx.fieldsRefer.subject]+'" ext:qtip="'+newqtip+'"';}var colorbackgr='';if(tasksinday[j][this.calx.fieldsRefer.color]){colorbackgr=tasksinday[j][this.calx.fieldsRefer.color];}else{colorbackgr=this.task_bgcolor_base;}if(this.calx.fieldsRefer.html!=''){var htmldatatowrite=tasksinday[j][this.calx.fieldsRefer.html];if(htmldatatowrite==null||htmldatatowrite==undefined){var Bfhtmlins='';var Afhtmlins='';}else{if(this.customHTMLinpos=='before'){var Bfhtmlins=htmldatatowrite+" ";var Afhtmlins='';}else if(this.customHTMLinpos=='after'){var Bfhtmlins='';var Afhtmlins=htmldatatowrite+" ";}else{var Bfhtmlins='';var Afhtmlins='';}}}else{var Bfhtmlins='';var Afhtmlins='';}dviewbody+='<div id="'+this.calx.id+'-ecal-daytask-'+this.taskelements+'" style="background-color:'+colorbackgr+'" ';dviewbody+=qtiptext;dviewbody+='ec_id="'+tasksinday[j][this.calx.fieldsRefer.id]+'" ec_starts="'+tasksinday[j][this.calx.fieldsRefer.startdate]+'"';dviewbody+='ec_ends="'+tasksinday[j][this.calx.fieldsRefer.enddate]+'" ec_subject="'+tasksinday[j][this.calx.fieldsRefer.subject]+'"';dviewbody+='ec_cnt="'+tasksinday[j][this.calx.fieldsRefer.description]+'" ec_storeindex="'+j+'" ';dviewbody+='ec_location="'+tasksinday[j][this.calx.fieldsRefer.location]+'" ';dviewbody+='ec_allday="'+tasksinday[j][this.calx.fieldsRefer.alldaytask]+'" ';dviewbody+='ec_isholiday="'+tasksinday[j][this.calx.fieldsRefer.isHoliday]+'">';dviewbody+=Bfhtmlins+tasksinday[j][this.calx.fieldsRefer.subject]+Afhtmlins+'</div>';this.taskelements+=1;}dviewbody+='</div>';}dviewbody+='</div></td>';}dviewbody+='</tr></table></div></div>';return dviewbody;}});