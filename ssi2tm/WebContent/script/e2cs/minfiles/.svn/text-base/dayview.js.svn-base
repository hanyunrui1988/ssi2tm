Ext.ECalendar.dayview=function(config){this.referid='dayview';this.header=true;this.headerFormat='l - d - F  - Y';this.headerButtons=true;this.moreMenuItems=[];this.hourScale=0;this.hourFormat='G:i';this.startTime='7:00:00 am';this.endTime='10:00:00 pm';this.scrolltoHour=false;this.task_useBorderStyle=false;this.task_useBordercolor='#225588';this.taskBaseColor='#ffffff';this.useMultiColorTasks=false;this.multiColorTasks=[];this.task_increment=5;this.task_width=50;this.tasksOffset=0;this.task_clsOver='';this.task_showqtip=true;this.task_format='d-m-Y h:i:s a';this.taskAdd_dblclick=true;this.taskAdd_timer_dblclick=true;this.task_DDeditable=true;this.task_eventLaunch='click';this.ShowMenuItems=[1,1,1,1,1,1];this.task_ShowMenuItems=[1,1,1,1,1];this.customHTMLinpos='before';this.forceTaskFit=false;this.headerUseTpl=false;this.headerTpl=new Ext.XTemplate('<tpl for=".">{title}-{datetouse:this.formatx}</tpl>',{formatx:function(value){return value.format('l - d - F  - Y');}});this.headerData={title:'Custom header for Day',datetouse:new Date()};this.tasks=[];Ext.apply(this,config);this.addEvents('beforeDayChange','afterDayChange');Ext.ECalendar.dayview.superclass.constructor.call(this);};Ext.extend(Ext.ECalendar.dayview,Ext.util.Observable,{init:function(calendar,dateval){this.calx=calendar;this.datetohandle=dateval;},refreshView:function(){this.render();},render:function(){var updateview=Ext.get(this.calx.body);var testrender=updateview.dom.childNodes.length;if(testrender){for(var i=testrender;i<testrender;i++){updateview.dom.removeChild(updateview.dom.childNodes[0]);}}updateview.update('');var updateview=Ext.get(this.calx.body);var daycntbase='<div id="'+this.calx.id+'-main-calendar-header"></div>';daycntbase+='<div id="'+this.calx.id+'-main-calendar-day-body"></div>';updateview.update(daycntbase);this.datetohandle=this.calx.currentdate;if(this.header){var dt=this.datetohandle;var tmpheader=this.genHeader(this.datetohandle);var tmpheader=Ext.get(this.calx.id+'-main-calendar-header');var prueba2=tmpheader;var myheaderwrap=prueba2.wrap({tag:'div',cls:'x-calendar-dayv-header',html:''});if(this.headerButtons){var prevdclick=myheaderwrap.createChild({id:this.calx.id+'-btn-pd',tag:'div',cls:'x-calendar-day-previous',html:''});var nextdclick=myheaderwrap.createChild({id:this.calx.id+'-btn-nd',tag:'div',cls:'x-calendar-day-next',html:''});prevdclick.dom['qtip']=e2cs.cal_locale.headerTooltipsDay.prev;prevdclick.addListener('click',this.onclickprev_day,this);prevdclick.addClassOnOver('x-calendar-day-previous-over');nextdclick.dom['qtip']=e2cs.cal_locale.headerTooltipsDay.next;nextdclick.addListener('click',this.onclicknext_day,this);nextdclick.addClassOnOver('x-calendar-day-next-over');}if(this.headerUseTpl){this.headerData.datetouse=this.datetohandle;var htmlinheader=this.headerTpl.apply(this.headerData);var headerdx=myheaderwrap.createChild({tag:'div',id:'header',html:''+htmlinheader+''});}else{var headerdx=myheaderwrap.createChild({tag:'div',id:'header',html:''+dt.format(this.headerFormat)+''});}}Ext.get(this.calx.id+'-main-calendar-header').setStyle('z-index','99999');var htmlday=this.genBody(this.datetohandle);var tmpdays=Ext.get(this.calx.id+'-main-calendar-day-body');var myheaderdayswrap=tmpdays.wrap({tag:'div',cls:'x-calendar-dayv-day',id:this.calx.id+'-wrapper',html:''});if(Ext.isIE){myheaderdayswrap.setStyle({position:'relative'});}this.calx.height=this.calx.getInnerHeight();if(!this.calx.height||this.calx.height=='undefined'){if(this.calx.getEl().dom.offsetParent!=null){var tmpheight=this.calx.getEl().dom.offsetParent.clientHeight;}else{var tmpheight=0;}}else{var tmpheight=this.calx.height;}if(tmpheight==0){tmpheight=300;}if(this.header){tmpheight+=-24;}if(this.calx.showCal_tbar){tmpheight+=-26;}if(this.calx.header){tmpheight+=-26;}var morehoffst=0;myheaderdayswrap.setStyle({height:''+tmpheight-morehoffst+'px'});myheaderdayswrap.setStyle({overflow:'auto'});tmpid=this.calx.id;myheaderdayswrap.addListener('scroll',function(){if(Ext.get(tmpid+'-daybody')){Ext.get(tmpid+'-daybody').setStyle('filter','alpha(opacity=100)');Ext.get(tmpid+'-daybody').setStyle('filter','');}});var mydays=myheaderdayswrap.createChild({tag:'div',id:this.calx.id+'-calendar-view-day',html:htmlday});if(Ext.isIE){mydays.setStyle({position:'relative'});}mydays.setStyle({position:'relative'});if(Ext.isIE||Ext.isIE6){Ext.get(this.calx.id+'-daylayoutbody').setStyle({position:'relative'});Ext.get(this.calx.id+'daylayoutbody').setWidth(Ext.get(this.calx.id+'daylayoutbody').getWidth()-25,false);Ext.get(this.calx.id+'-tableallday').setStyle({position:'relative'});}var mydaybody=Ext.get(this.calx.id+'-daybody');var dblclickdate=this.calx.currentdate;var tmpcalendarobjinstance=this.calx;var testdblclick=this.taskAdd_dblclick;if(testdblclick){mydaybody.addListener('dblclick',function(evx,elx,obx){if(elx.id.indexOf('-daybody')<0){return false;}var dt_tmp_dt=dblclickdate;var tmpYtouse=Ext.get(tmpcalendarobjinstance.id+'-calendar-view-day').getY();if(Ext.isIE){var mytimeTD_elements=(this.hourScale==0)?Ext.select('td.hour-marker_ie',true):Ext.select('td.hour-marker_ie-30',true);}else{var mytimeTD_elements=(this.hourScale==0)?Ext.select('td.hour-marker',true):Ext.select('td.hour-marker-30',true);}mytimeTD_elements.each(function(el,thisobj,index){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-dayv-')+1>=1){var CYtmp=Ext.get(el).getY();var CHtmp=Ext.get(el).getHeight();var tmpCurrY=evx.getPageY();if(tmpCurrY>=CYtmp&&tmpCurrY<=(CYtmp+CHtmp)){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-dayv-')<0){var mydt_element_test=Ext.get(el).parent().id.replace(tmpcalendarobjinstance.id+'-tdbody-dayv-','');}else{var mydt_element_test=el.id.replace(tmpcalendarobjinstance.id+'-tdbody-dayv-','');}dt_tmp_dt=new Date(mydt_element_test);return false;}else{return true;}}},this);tmpcalendarobjinstance.fireEvent("taskAdd",dt_tmp_dt);});}if(this.taskAdd_timer_dblclick){if(Ext.isIE){var mytimeTD_elements=(this.hourScale==0)?Ext.select('td.hour-marker_ie',true):Ext.select('td.hour-marker_ie-30',true);}else{var mytimeTD_elements=(this.hourScale==0)?Ext.select('td.hour-marker',true):Ext.select('td.hour-marker-30',true);}mytimeTD_elements.each(function(el,thisobj,index){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-dayv-')+1>=1){el.addListener('dblclick',function(evx,elx,obx){if(elx.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-dayv-')<0){var mydt_element_test=Ext.get(elx).parent().id.replace(tmpcalendarobjinstance.id+'-tdbody-dayv-','');}else{var mydt_element_test=elx.id.replace(tmpcalendarobjinstance.id+'-tdbody-dayv-','');}var mytmpdate=new Date(mydt_element_test);tmpcalendarobjinstance.fireEvent("taskAdd",mytmpdate);});}},this);}mydaybody.setHeight(Ext.get('tdbaseday').getHeight(true));if(Ext.isOpera){mydaybody.addListener('mousedown',this.operadaybuttons,this);}else{mydaybody.on('contextmenu',this.oncontextmenuBody,this,{stopPropagation:true,stopEvent:true,normalized:true,preventDefault:true});}this.tasks=[];var dateinionthisday=new Date(this.datetohandle.format('m/d/Y')+' '+this.startTime);var dateendonthisday=new Date(this.datetohandle.format('m/d/Y')+' '+this.endTime);var counttasks=this.calx.store.getCount();var countdone=0;for(var i=0;i<counttasks;i++){var testrec=this.calx.store.getAt(i).data;testdateinit=this.calx.store.getAt(i).data[this.calx.fieldsRefer.startdate];testdateend=this.calx.store.getAt(i).data[this.calx.fieldsRefer.enddate];checkdates=this.datetohandle.between(new Date(testdateinit),new Date(testdateend));chkformat=this.datetohandle.format('m/d/Y');test=new Date(testdateinit);if(test.format('m/d/Y')==chkformat){checkdates=true;}test=new Date(testdateend);if(test.format('m/d/Y')==chkformat){checkdates=true;}if(checkdates){countdone+=1;}}var counttasks=countdone;if(counttasks>0){currentindex=0;created=0;previndex=0;if(this.tasksOffset=='auto'){var newwfix=counttasks*this.task_width;}else{var newwfix=(counttasks*this.task_width)-((counttasks-1)*this.tasksOffset);}if(Ext.get('tdbaseday').getWidth(true)<newwfix){if(!this.calx.width||this.calx.width=='undefined'){}else{Ext.get(this.calx.id+'-daybody').setWidth(newwfix,false);Ext.get(this.calx.id+'daylayoutbody').setWidth(Ext.get(this.calx.id+'-tableallday').getWidth(true)+1,false);}var test=11;}var counttasks=this.calx.store.getCount();var Tasktohandle=[];for(var itask=0;itask<counttasks;itask++){dateinit=this.calx.store.getAt(itask).data[this.calx.fieldsRefer.startdate];dateend=this.calx.store.getAt(itask).data[this.calx.fieldsRefer.enddate];checkdates=this.datetohandle.between(new Date(dateinit),new Date(dateend));chkformat=this.datetohandle.format('m/d/Y');test=new Date(dateinit);if(test.format('m/d/Y')==chkformat){checkdates=true;}test=new Date(dateend);if(test.format('m/d/Y')==chkformat){checkdates=true;}if(checkdates){Tasktohandle.push(itask);}}var allDayTasks=new Array();for(var i=0;i<Tasktohandle.length;i++){var taskIdx=Tasktohandle[i];allDayTasks.push(this.calx.store.getAt(taskIdx).data);}var storex=new Ext.data.JsonStore({storeId:'tmpstore',root:'datarecs',idProperty:'recid',fields:[{name:'recid'},{name:'startdate'},{name:'enddate'}]});storex.loadData({datarecs:allDayTasks});storex.sort('startdate','ASC');var misdatoshandlerender=[];for(var i=0;i<storex.getCount();i++){if(i==0){var idx=-1;}else{var idx=(i-1);}var datax=this.calx.overlapEventsdata(storex.getAt(i).data,{datarecs:allDayTasks},i,idx,misdatoshandlerender);misdatoshandlerender.push(datax);}var test=11;for(var i=0;i<storex.getCount();i++){itask=i;var rectouse=this.calx.store.getById(storex.getAt(itask).data.recid);if(rectouse.data[this.calx.fieldsRefer.color]){colortask=rectouse.data[this.calx.fieldsRefer.color];}else{colortask=this.taskBaseColor;}var tmpdescriptionx='';var tmpdescription=rectouse.data[this.calx.fieldsRefer.description];if(tmpdescription.length>this.calx.tipmaxLength){var tmpdescriptionx=tmpdescription.substring(0,this.calx.tipmaxLength)+'...';}var tmpholiday=rectouse.data[this.calx.fieldsRefer.isHoliday];if(tmpholiday==undefined||tmpholiday==''){tmpholiday=0;}var tmpallday=rectouse.data[this.calx.fieldsRefer.task_isallday];if(tmpallday==undefined||tmpallday==''){tmpallday=0;}this.tasks[i]=new Ext.ECalendar.daytask({renderdatatoUse:misdatoshandlerender,tasksOffset:this.tasksOffset,evenLaunch:this.task_eventLaunch,editable:this.task_DDeditable,parentview:this,baseBody:mydaybody,datehandle:this.datetohandle,showQtip:this.task_showqtip,contextMenuLabels:e2cs.cal_locale.contextMenuLabelsDay,tplqTip:this.calx.tplTaskTip,task_index:itask,task_id:rectouse.data[this.calx.fieldsRefer.id],task_subject:rectouse.data[this.calx.fieldsRefer.subject],task_starts:rectouse.data[this.calx.fieldsRefer.startdate],task_ends:rectouse.data[this.calx.fieldsRefer.enddate],task_description:tmpdescriptionx,customHtml:rectouse.data[this.calx.fieldsRefer.html],customHTMLinpos:this.customHTMLinpos,task_clsOver:this.task_clsOver,task_increment:this.task_increment,task_width:this.task_width,task_format:this.task_format,bgcolor:colortask,moreMenuItems:this.moreMenuItems,ShowMenuItems:this.task_ShowMenuItems,forceTaskFit:this.forceTaskFit,totalTasksonView:Tasktohandle.length,task_useBxStyle:this.task_useBorderStyle,task_useBxcolor:this.task_useBordercolor,task_location:rectouse.data[this.calx.fieldsRefer.location],task_isholiday:tmpholiday,task_isallday:tmpallday,scale:this.hourScale,allDayTasks:allDayTasks});this.tasks[i].init(this.calx,this);this.tasks[i].render();}storex.destroy();if(Ext.get(this.calx.id+'daylayoutbody').getWidth(true)<Ext.get(this.calx.id+'-tableallday').getWidth(true)){Ext.get(this.calx.id+'daylayoutbody').setWidth(Ext.get(this.calx.id+'-tableallday').getWidth(true)+1,false);}if(this.tasks.length<=0){mydaybody.update('&nbsp;');}}else{mydaybody.update('&nbsp;');}myheaderdayswrap.dom.scrollTop=0;if(this.scrolltoHour){var sct_top=0;if(Ext.isIE){var mytimeTD_elements=(this.hourScale==0)?Ext.select('td.hour-marker_ie',true):Ext.select('td.hour-marker_ie-30',true);}else{var mytimeTD_elements=(this.hourScale==0)?Ext.select('td.hour-marker',true):Ext.select('td.hour-marker-30',true);}mytimeTD_elements.each(function(el,thisobj,index){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-dayv-')+1>=1){var testfmt=this.datetohandle.format('G:i');if(el.id.indexOf(testfmt)+1>=1){sct_top=Ext.get(el).getY();return false;}}},this);if(sct_top>0){sct_top=sct_top-myheaderdayswrap.getY();myheaderdayswrap.dom.scrollTop=sct_top;}}},refreshevents_only:function(){var bodytmp=Ext.get(this.calx.id+'-daybody');var mydaybody=Ext.get(this.calx.id+'-daybody');var countchilds=bodytmp.dom.childNodes.length;for(var i=0;i<countchilds;i++){Ext.get(bodytmp.dom.childNodes[0].id).removeAllListeners();Ext.get(bodytmp.dom.childNodes[0].id).remove();}myheaderdayswrap=Ext.get(this.calx.id+'-wrapper');this.tasks=[];var dateinionthisday=new Date(this.datetohandle.format('m/d/Y')+' '+this.startTime);var dateendonthisday=new Date(this.datetohandle.format('m/d/Y')+' '+this.endTime);var counttasks=this.calx.store.getCount();var countdone=0;for(var i=0;i<counttasks;i++){var testrec=this.calx.store.getAt(i).data;testdateinit=this.calx.store.getAt(i).data[this.calx.fieldsRefer.startdate];testdateend=this.calx.store.getAt(i).data[this.calx.fieldsRefer.enddate];checkdates=this.datetohandle.between(new Date(testdateinit),new Date(testdateend));chkformat=this.datetohandle.format('m/d/Y');test=new Date(testdateinit);if(test.format('m/d/Y')==chkformat){checkdates=true;}test=new Date(testdateend);if(test.format('m/d/Y')==chkformat){checkdates=true;}if(checkdates){countdone+=1;}}var counttasks=countdone;if(counttasks>0){currentindex=0,created=0,previndex=0;if(this.tasksOffset=='auto'){var newwfix=counttasks*this.task_width;}else{var newwfix=(counttasks*this.task_width)-((counttasks-1)*this.tasksOffset);}if(Ext.get('tdbaseday').getWidth(true)<newwfix){if(!this.calx.width||this.calx.width=='undefined'){}else{Ext.get(this.calx.id+'-daybody').setWidth(newwfix,false);Ext.get(this.calx.id+'daylayoutbody').setWidth(Ext.get(this.calx.id+'-tableallday').getWidth(true)+1,false);}}var counttasks=this.calx.store.getCount();var Tasktohandle=[];for(var itask=0;itask<counttasks;itask++){dateinit=this.calx.store.getAt(itask).data[this.calx.fieldsRefer.startdate];dateend=this.calx.store.getAt(itask).data[this.calx.fieldsRefer.enddate];checkdates=this.datetohandle.between(new Date(dateinit),new Date(dateend));chkformat=this.datetohandle.format('m/d/Y');test=new Date(dateinit);if(test.format('m/d/Y')==chkformat){checkdates=true;}test=new Date(dateend);if(test.format('m/d/Y')==chkformat){checkdates=true;}if(checkdates){Tasktohandle.push(itask);}}var allDayTasks=new Array();for(var i=0;i<Tasktohandle.length;i++){var taskIdx=Tasktohandle[i];allDayTasks.push(this.calx.store.getAt(taskIdx).data);}var storex=new Ext.data.JsonStore({storeId:'tmpstore',root:'datarecs',idProperty:'recid',fields:[{name:'recid'},{name:'startdate'},{name:'enddate'}]});storex.loadData({datarecs:allDayTasks});storex.sort('startdate','ASC');var misdatoshandlerender=[];for(var i=0;i<storex.getCount();i++){if(i==0){var idx=-1;}else{var idx=(i-1);}var datax=this.calx.overlapEventsdata(storex.getAt(i).data,{datarecs:allDayTasks},i,idx,misdatoshandlerender);misdatoshandlerender.push(datax);}for(var i=0;i<storex.getCount();i++){itask=i;var rectouse=this.calx.store.getById(storex.getAt(itask).data.recid);if(rectouse.data[this.calx.fieldsRefer.color]){colortask=rectouse.data[this.calx.fieldsRefer.color];}else{colortask=this.taskBaseColor;}var tmpdescriptionx='';var tmpdescription=rectouse.data[this.calx.fieldsRefer.description];if(tmpdescription.length>this.calx.tipmaxLength){var tmpdescriptionx=tmpdescription.substring(0,this.calx.tipmaxLength)+'...';}var tmpholiday=rectouse.data[this.calx.fieldsRefer.isHoliday];if(tmpholiday==undefined||tmpholiday==''){tmpholiday=0;}var tmpallday=rectouse.data[this.calx.fieldsRefer.task_isallday];if(tmpallday==undefined||tmpallday==''){tmpallday=0;}this.tasks[i]=new Ext.ECalendar.daytask({renderdatatoUse:misdatoshandlerender,tasksOffset:this.tasksOffset,evenLaunch:this.task_eventLaunch,editable:this.task_DDeditable,parentview:this,baseBody:mydaybody,datehandle:this.datetohandle,showQtip:this.task_showqtip,contextMenuLabels:e2cs.cal_locale.contextMenuLabelsDay,tplqTip:this.calx.tplTaskTip,task_index:itask,task_id:rectouse.data[this.calx.fieldsRefer.id],task_subject:rectouse.data[this.calx.fieldsRefer.subject],task_starts:rectouse.data[this.calx.fieldsRefer.startdate],task_ends:rectouse.data[this.calx.fieldsRefer.enddate],task_description:tmpdescriptionx,customHtml:rectouse.data[this.calx.fieldsRefer.html],customHTMLinpos:this.customHTMLinpos,task_clsOver:this.task_clsOver,task_increment:this.task_increment,task_width:this.task_width,task_format:this.task_format,bgcolor:colortask,moreMenuItems:this.moreMenuItems,ShowMenuItems:this.task_ShowMenuItems,forceTaskFit:this.forceTaskFit,totalTasksonView:Tasktohandle.length,task_useBxStyle:this.task_useBorderStyle,task_useBxcolor:this.task_useBordercolor,task_location:rectouse.data[this.calx.fieldsRefer.location],task_isholiday:tmpholiday,task_isallday:tmpallday,scale:this.hourScale,allDayTasks:allDayTasks});this.tasks[i].init(this.calx,this);this.tasks[i].render();}storex.destroy();if(Ext.get(this.calx.id+'daylayoutbody').getWidth(true)<Ext.get(this.calx.id+'-tableallday').getWidth(true)){Ext.get(this.calx.id+'daylayoutbody').setWidth(Ext.get(this.calx.id+'-tableallday').getWidth(true)+1,false);}if(this.tasks.length<=0){mydaybody.update('&nbsp;');}}else{mydaybody.update('&nbsp;');}},operadaybuttons:function(evx,elx,obx){if(Ext.isOpera){if(evx.button==2){this.oncontextmenuBody(evx,elx,obx);}}else{return false;}},oncontextmenuBody:function(evx,elx,obx){if(Ext.isOpera){if(evx.button!=2){return false;}}if(this.ShowMenuItems[0]!=true&&this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[5]!=true){return false;}if(Ext.version.substr(0,1)=="2"){evx.stopEvent();}if(elx.id.indexOf(this.calx.id+"-daybody")<0){return false;}var tmpdata=Ext.get(elx.id);if(this.menu){this.menu.removeAll();}this.menu=new Ext.menu.Menu({id:this.calx.id+'-contextmenu-day',shadow:true,items:[{id:this.calx.id+'-day_ctxbtn_task-add',iconCls:'x-calendar-day-btnmv_add',text:e2cs.cal_locale.contextMenuLabelsDay.taskAdd,scope:this},'-',{id:this.calx.id+'-day_ctxbtn_task-go-nd',iconCls:'x-calendar-day-btnmv_nextday',text:e2cs.cal_locale.contextMenuLabelsDay.NextDay,scope:this},{id:this.calx.id+'-day_ctxbtn_task-go-pd',iconCls:'x-calendar-day-btnmv_prevday',text:e2cs.cal_locale.contextMenuLabelsDay.PreviousDay,scope:this},'-',{id:this.calx.id+'-day_ctxbtn_viewmonth',iconCls:'x-calendar-month-btnmv_viewmonth',text:e2cs.cal_locale.contextMenuLabelsDay.chgmview,scope:this},{id:this.calx.id+'-day_ctxbtn_viewweek',iconCls:'x-calendar-month-btnmv_viewweek',text:e2cs.cal_locale.contextMenuLabelsDay.chgwview,scope:this},{id:this.calx.id+'-day_ctxbtn_viewsched',iconCls:'x-calendar-month-btnmv_viewsched',text:e2cs.cal_locale.contextMenuLabelsDay.chgsview,scope:this}]});this.menu.items.items[0].addListener('click',function(){var dt_tmp_dt=this.calx.currentdate;var tmpcalendarobjinstance=this.calx;var tmpYtouse=Ext.get(this.calx.id+'-calendar-view-day').getY();if(Ext.isIE){var mytimeTD_elements=(this.hourScale==0)?Ext.select('td.hour-marker_ie',true):Ext.select('td.hour-marker_ie-30',true);}else{var mytimeTD_elements=(this.hourScale==0)?Ext.select('td.hour-marker',true):Ext.select('td.hour-marker-30',true);}mytimeTD_elements.each(function(el,thisobj,index){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-dayv-')+1>=1){var CYtmp=Ext.get(el).getY();var CHtmp=Ext.get(el).getHeight();if(Ext.version.substr(0,1)=="2"){var tmpCurrY=evx.getPageY();}else{var tmpCurrY=evx.pageY;}if(tmpCurrY>=CYtmp&&tmpCurrY<=(CYtmp+CHtmp)){if(el.id.indexOf(tmpcalendarobjinstance.id+'-tdbody-dayv-')<0){var mydt_element_test=Ext.get(el).parent().id.replace(tmpcalendarobjinstance.id+'-tdbody-dayv-','');}else{var mydt_element_test=el.id.replace(tmpcalendarobjinstance.id+'-tdbody-dayv-','');}dt_tmp_dt=new Date(mydt_element_test);return false;}else{return true;}}},this);this.calx.fireEvent("taskAdd",dt_tmp_dt);},this);this.menu.items.items[2].addListener('click',function(){this.onclicknext_day();},this);this.menu.items.items[3].addListener('click',function(){this.onclickprev_day();},this);this.menu.items.items[5].addListener('click',function(){this.changeCalview(Ext.get(elx),this,1);},this);this.menu.items.items[6].addListener('click',function(){this.changeCalview(Ext.get(elx),this,2);},this);this.menu.items.items[7].addListener('click',function(){this.changeCalview(Ext.get(elx),this,3);},this);if(this.ShowMenuItems[0]!=true){this.menu.items.items[0].hidden=true;this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[1]!=true){this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true){this.menu.items.items[2].hidden=true;}if(this.ShowMenuItems[2]!=true){this.menu.items.items[3].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true){this.menu.items.items[4].hidden=true;}if(this.ShowMenuItems[3]!=true){this.menu.items.items[5].hidden=true;}if(this.ShowMenuItems[4]!=true){this.menu.items.items[6].hidden=true;}if(this.ShowMenuItems[5]!=true){this.menu.items.items[7].hidden=true;}if(!this.calx.mview){this.menu.items.items[5].hidden=true;}if(!this.calx.wview){this.menu.items.items[6].hidden=true;}if(!this.calx.sview){this.menu.items.items[7].hidden=true;}if(Ext.version.substr(0,1)=="2"){this.menu.on('hide',this.onContextHide,this);this.menu.showAt([evx.getPageX(),evx.getPageY()]);}else{this.menu.on('hide',this.onContextHideBodyDAY,this);this.menu.showAt([evx.clientX,evx.clientY]);}},onContextHideBodyDAY:function(obj){if(Ext.version.substr(0,1)=="3"){obj.removeAll();obj.destroy();}},onContextHide:function(){},changeCalview:function(objx,mviewx,typeview){if(objx.dom.className=='noday'||objx.dom.className=='today'||objx.dom.className=='monthday'){var refdate=new Date(objx.id);}else if(objx.dom.className=='tasks'){var refdate=new Date(objx.dom.parentNode.firstChild.id);}else{var refdate=new Date(objx.dom.firstChild.id);}if(typeview==1){varview='month';}else if(typeview==2){varview='week';}else{varview='schedule';}this.calx.changeView(varview);},onclickprev_day:function(evx,elx,obx){var changedaydate=this.datetohandle.add(Date.DAY,-1);var check=this.fireEvent("beforeDayChange",this.datetohandle,changedaydate);if(check){this.calx.currentdate=changedaydate;this.datetohandle=changedaydate;this.render();this.fireEvent("afterDayChange",changedaydate);}},onclicknext_day:function(evx,elx,obx){var changedaydate=this.datetohandle.add(Date.DAY,1);var check=this.fireEvent("beforeDayChange",this.datetohandle,changedaydate);if(check){this.calx.currentdate=changedaydate;this.datetohandle=changedaydate;this.render();this.fireEvent("afterDayChange",changedaydate);}},genHeader:function(dateval){var dt=new Date(dateval);Date.monthNames=e2cs.cal_locale.monthtitles;Date.dayNames=e2cs.cal_locale.daytitles;var myheader='<div class="x-calendar-dayv-header" style="width:'+(this.calx.width-10)+'px;">';myheader+='<div id="header">'+dt.format(this.headerFormat)+'</div>';if(this.headerButtons){myheader+='<div class="x-calendar-day-previous"></div>';myheader+='<div class="x-calendar-day-next"></div>';}myheader+='</div>';return myheader;},genBody:function(dateval){var dt=new Date(dateval);var inittime=new Date(dt.format('m/d/Y')+' '+this.startTime);var endtime=new Date(dt.format('m/d/Y')+' '+this.endTime);this.diffhrs=this.calx.dateDiff(inittime,endtime,e2cs.dateParts.HOUR);var wtdisp='';if(Ext.isIE||Ext.isIE6){wtdisp='97.8';}else{wtdisp='100';}wtdisp='100';var dviewbody='<div id="'+this.calx.id+'daylayoutbody" class="x-calendar-dayv-body" style="position:relative;">';dviewbody+='<table id="'+this.calx.id+'-tableallday" width="'+wtdisp+'%" border="0" cellspacing="1" cellpadding="0"><tr><td valign="top" width="50">';dviewbody+='<table width="50" border="0" align="center" cellpadding="0" cellspacing="0">';for(var i=0;i<this.diffhrs;i++){tmpdatetohandleontd=dt.format('m/d/Y');tmpdatetohandleontd+=' '+inittime.add(Date.HOUR,(i)).format('G');tmpdatetohandleontd+=':'+inittime.add(Date.HOUR,(i)).format('i');if(Ext.isIE){var mymarker=(this.hourScale==0)?'hour-marker_ie':'hour-marker_ie-30';var mydatatd=' align="center" valign="middle" ';}else{var mymarker=(this.hourScale==0)?'hour-marker':'hour-marker-30';var mydatatd='';}dviewbody+='<tr><td '+mydatatd+' id="'+this.calx.id+'-tdbody-dayv-'+tmpdatetohandleontd+'" class="'+mymarker+'">';dviewbody+='<span>'+inittime.add(Date.HOUR,(i)).format(this.hourFormat)+'</span></td></tr>';}var mydatacomp=' style="position:relative; z-index:3000;" ';if(Ext.isIE||Ext.isIE6||Ext.isIE7){mydatacomp=' style="position:relative; z-index:3000;" ';}dviewbody+='</table></td><td valign="top" id="tdbaseday"'+mydatacomp+'>';if(Ext.isIE||Ext.isIE6||Ext.isIE7){if(this.hourScale==0){dviewbody+='<div id="'+this.calx.id+'-daybody" class="basegridday_ie6"'+mydatacomp+'>';}else{dviewbody+='<div id="'+this.calx.id+'-daybody" class="basegridday30mins_ie6"'+mydatacomp+'>';}}else{if(this.hourScale==0){dviewbody+='<div id="'+this.calx.id+'-daybody" class="basegridday" '+mydatacomp+'>';}else{dviewbody+='<div id="'+this.calx.id+'-daybody" class="basegridday30mins" '+mydatacomp+'>';}}dviewbody+='';dviewbody+='</div>';dviewbody+='</td></tr></table>';dviewbody+='</div>';return dviewbody;}});